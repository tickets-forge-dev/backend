<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executable Tickets - 8-Step Generation Flow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gray-50: #fafafa;
      --gray-100: #f4f4f5;
      --gray-200: #e4e4e7;
      --gray-300: #d4d4d8;
      --gray-400: #a1a1aa;
      --gray-500: #71717a;
      --gray-600: #52525b;
      --gray-700: #3f3f46;
      --gray-800: #27272a;
      --gray-900: #18181b;

      --green: #10b981;
      --amber: #f59e0b;
      --red: #ef4444;
      --blue: #3b82f6;

      --bg: #ffffff;
      --bg-subtle: #fafafa;
      --bg-hover: #f4f4f5;
      --bg-active: #e4e4e7;
      --border: #e4e4e7;

      --text: #18181b;
      --text-secondary: #52525b;
      --text-tertiary: #a1a1aa;

      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, monospace;

      --text-xs: 11px;
      --text-sm: 12px;
      --text-base: 13px;
      --text-md: 14px;
      --text-lg: 16px;
      --text-xl: 18px;

      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-6: 24px;
      --space-8: 32px;
      --space-12: 48px;

      --radius: 6px;
      --radius-md: 8px;
      --radius-full: 9999px;
    }

    body {
      font-family: var(--font-sans);
      font-size: var(--text-base);
      color: var(--text);
      background: var(--bg);
    }

    /* Controls */
    .controls {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--gray-900);
      color: white;
      padding: var(--space-4) var(--space-6);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .controls-title {
      font-size: var(--text-md);
      font-weight: 500;
    }

    .controls-buttons {
      display: flex;
      gap: var(--space-2);
    }

    .controls button {
      background: transparent;
      border: 1px solid var(--gray-700);
      color: white;
      padding: 6px 12px;
      border-radius: var(--radius);
      font-size: var(--text-sm);
      cursor: pointer;
      font-family: var(--font-sans);
    }

    .controls button:hover {
      background: var(--gray-800);
    }

    /* Top Nav */
    .top-nav {
      margin-top: 60px;
      height: 56px;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      padding: 0 var(--space-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text);
    }

    /* Main Content */
    .main-content {
      max-width: 640px;
      margin: 0 auto;
      padding: var(--space-12) var(--space-6);
    }

    .progress-header {
      margin-bottom: var(--space-8);
      text-align: center;
    }

    .progress-title {
      font-size: var(--text-xl);
      color: var(--text);
      margin-bottom: var(--space-2);
    }

    .progress-subtitle {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    /* Step List */
    .step-list {
      list-style: none;
    }

    .step {
      display: flex;
      gap: var(--space-4);
      padding: var(--space-4) 0;
      border-bottom: 1px solid var(--border);
    }

    .step:last-child {
      border-bottom: none;
    }

    .step-icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--text-xs);
      font-weight: 600;
      margin-top: 2px;
    }

    .step-icon.pending {
      border: 2px solid var(--border);
      color: var(--text-tertiary);
      background: var(--bg);
    }

    .step-icon.in-progress {
      border: 2px solid var(--blue);
      color: var(--blue);
      background: rgba(59, 130, 246, 0.1);
      animation: pulse 2s infinite;
    }

    .step-icon.completed {
      background: var(--green);
      color: white;
    }

    .step-icon.failed {
      background: var(--red);
      color: white;
    }

    .step-icon.skipped {
      background: var(--gray-200);
      color: var(--text-tertiary);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .step-content {
      flex: 1;
    }

    .step-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-2);
    }

    .step-title {
      font-size: var(--text-md);
      color: var(--text);
    }

    .step-title.secondary {
      color: var(--text-secondary);
    }

    .step-title.tertiary {
      color: var(--text-tertiary);
    }

    .step-title.failed {
      color: var(--red);
    }

    .step-number {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      margin-right: var(--space-2);
    }

    .step-toggle {
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      font-size: var(--text-xs);
      cursor: pointer;
      padding: 2px 8px;
      border-radius: var(--radius);
    }

    .step-toggle:hover {
      background: var(--bg-hover);
    }

    .step-details {
      display: none;
      margin-top: var(--space-3);
      padding: var(--space-3);
      background: var(--bg-subtle);
      border-radius: var(--radius);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .step-details.expanded {
      display: block;
    }

    .step-details code {
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      background: var(--bg);
      padding: 2px 4px;
      border-radius: var(--radius-sm);
    }

    .retry-btn {
      margin-top: var(--space-3);
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: var(--radius);
      font-size: var(--text-sm);
      cursor: pointer;
      font-family: var(--font-sans);
    }

    .retry-btn:hover {
      background: var(--bg-hover);
    }

    /* Completion State */
    .completion-message {
      margin-top: var(--space-8);
      padding: var(--space-6);
      background: rgba(16, 185, 129, 0.05);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .completion-title {
      font-size: var(--text-lg);
      color: var(--green);
      margin-bottom: var(--space-2);
    }

    .completion-subtitle {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <!-- Controls -->
  <div class="controls">
    <div class="controls-title">8-Step Generation Progress - Interactive Demo</div>
    <div class="controls-buttons">
      <button onclick="simulateProgress()">▶ Simulate Progress</button>
      <button onclick="reset()">↻ Reset</button>
      <button onclick="simulateError()">✗ Simulate Error</button>
    </div>
  </div>

  <!-- Top Nav -->
  <div class="top-nav">
    <div class="logo">Executable Tickets</div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="progress-header">
      <h1 class="progress-title">Generating Ticket</h1>
      <p class="progress-subtitle" id="subtitle">Working through 8 steps to create your executable ticket...</p>
    </div>

    <ul class="step-list" id="stepList">
      <!-- Step 1 -->
      <li class="step" id="step-1">
        <div class="step-icon pending">1</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 1 of 8</span>
              <span class="step-title">Intent Extraction</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(1)">Details ↓</button>
          </div>
          <div class="step-details" id="details-1">
            <p>Parsing user input to understand ticket requirements...</p>
          </div>
        </div>
      </li>

      <!-- Step 2 -->
      <li class="step" id="step-2">
        <div class="step-icon pending">2</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 2 of 8</span>
              <span class="step-title">Type Detection</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(2)">Details ↓</button>
          </div>
          <div class="step-details" id="details-2">
            <p>Classifying ticket as Feature, Bug, or Task...</p>
          </div>
        </div>
      </li>

      <!-- Step 3 -->
      <li class="step" id="step-3">
        <div class="step-icon pending">3</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 3 of 8</span>
              <span class="step-title">Repo Index Query</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(3)">Details ↓</button>
          </div>
          <div class="step-details" id="details-3">
            <p>Finding relevant code modules in your repositories...</p>
          </div>
        </div>
      </li>

      <!-- Step 4 -->
      <li class="step" id="step-4">
        <div class="step-icon pending">4</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 4 of 8</span>
              <span class="step-title">API Snapshot Resolution</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(4)">Details ↓</button>
          </div>
          <div class="step-details" id="details-4">
            <p>Resolving OpenAPI specification version...</p>
          </div>
        </div>
      </li>

      <!-- Step 5 -->
      <li class="step" id="step-5">
        <div class="step-icon pending">5</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 5 of 8</span>
              <span class="step-title">Ticket Drafting</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(5)">Details ↓</button>
          </div>
          <div class="step-details" id="details-5">
            <p>Generating acceptance criteria and assumptions...</p>
          </div>
        </div>
      </li>

      <!-- Step 6 -->
      <li class="step" id="step-6">
        <div class="step-icon pending">6</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 6 of 8</span>
              <span class="step-title">Validation</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(6)">Details ↓</button>
          </div>
          <div class="step-details" id="details-6">
            <p>Running validators: structural, behavioral, testability, risk, permissions...</p>
          </div>
        </div>
      </li>

      <!-- Step 7 -->
      <li class="step" id="step-7">
        <div class="step-icon pending">7</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 7 of 8</span>
              <span class="step-title">Question Preparation</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(7)">Details ↓</button>
          </div>
          <div class="step-details" id="details-7">
            <p>Identifying clarification questions based on validation issues...</p>
          </div>
        </div>
      </li>

      <!-- Step 8 -->
      <li class="step" id="step-8">
        <div class="step-icon pending">8</div>
        <div class="step-content">
          <div class="step-header">
            <div>
              <span class="step-number">Step 8 of 8</span>
              <span class="step-title">Effort Estimation</span>
            </div>
            <button class="step-toggle" onclick="toggleDetails(8)">Details ↓</button>
          </div>
          <div class="step-details" id="details-8">
            <p>Calculating effort based on modules, API changes, and complexity...</p>
          </div>
        </div>
      </li>
    </ul>

    <div class="completion-message" id="completionMessage" style="display: none;">
      <div class="completion-title">✓ Ticket Generated Successfully</div>
      <div class="completion-subtitle">Redirecting to ticket detail view...</div>
    </div>
  </div>

  <script>
    const stepResults = {
      1: {
        title: 'Intent Extraction',
        completed: 'Extracted user intent: "Implement OAuth authentication for user login"',
        inProgress: 'Analyzing user input...',
      },
      2: {
        title: 'Type Detection',
        completed: 'Classified as: <strong>Feature</strong>',
        inProgress: 'Classifying ticket type...',
      },
      3: {
        title: 'Repo Index Query',
        completed: 'Found 3 relevant modules:<br>• <code>src/auth/components/LoginForm.tsx</code><br>• <code>src/auth/stores/auth.store.ts</code><br>• <code>backend/src/auth/application/AuthUseCase.ts</code>',
        inProgress: 'Searching code repositories...',
      },
      4: {
        title: 'API Snapshot Resolution',
        completed: 'API snapshot locked: <code>openapi.yaml</code> (hash: <code>a1b2c3</code>)',
        inProgress: 'Resolving OpenAPI specification...',
        skipped: 'No OpenAPI specification found in repository',
      },
      5: {
        title: 'Ticket Drafting',
        completed: 'Generated 4 acceptance criteria and 3 assumptions',
        inProgress: 'Drafting ticket content...',
      },
      6: {
        title: 'Validation',
        completed: 'Readiness score: <strong style="color: var(--green);">85/100</strong><br>• Structural: 95<br>• Behavioral: 88<br>• Testability: 75<br>• Risk: 100<br>• Permissions: 100',
        inProgress: 'Running 5 validators...',
      },
      7: {
        title: 'Question Preparation',
        completed: 'No clarification questions needed (readiness ≥ 75)',
        inProgress: 'Analyzing validation issues...',
        skipped: 'Readiness score ≥ 75 - no questions needed',
      },
      8: {
        title: 'Effort Estimation',
        completed: 'Estimate: <strong>4-8 hours</strong> (Medium confidence)<br>Drivers: 3 modules touched, Auth logic change',
        inProgress: 'Calculating effort estimate...',
      },
    };

    let currentStep = 0;
    let progressInterval = null;

    function toggleDetails(stepNum) {
      const details = document.getElementById(`details-${stepNum}`);
      const toggle = details.previousElementSibling.querySelector('.step-toggle');

      details.classList.toggle('expanded');
      toggle.textContent = details.classList.contains('expanded') ? 'Details ↑' : 'Details ↓';
    }

    function updateStep(stepNum, state, message) {
      const step = document.getElementById(`step-${stepNum}`);
      const icon = step.querySelector('.step-icon');
      const title = step.querySelector('.step-title');
      const details = document.getElementById(`details-${stepNum}`);

      // Update icon
      icon.className = `step-icon ${state}`;
      if (state === 'completed') {
        icon.textContent = '✓';
      } else if (state === 'failed') {
        icon.textContent = '✗';
      } else if (state === 'skipped') {
        icon.textContent = '—';
      } else {
        icon.textContent = stepNum;
      }

      // Update title color
      if (state === 'in-progress') {
        title.className = 'step-title';
      } else if (state === 'completed') {
        title.className = 'step-title secondary';
      } else if (state === 'failed') {
        title.className = 'step-title failed';
      } else {
        title.className = 'step-title tertiary';
      }

      // Update details
      if (message) {
        details.innerHTML = `<p>${message}</p>`;
      }

      // Auto-expand details for in-progress and failed
      if (state === 'in-progress' || state === 'failed') {
        details.classList.add('expanded');
        const toggle = step.querySelector('.step-toggle');
        toggle.textContent = 'Details ↑';
      }

      // Add retry button for failed steps
      if (state === 'failed') {
        const existingRetry = details.querySelector('.retry-btn');
        if (!existingRetry) {
          const retryBtn = document.createElement('button');
          retryBtn.className = 'retry-btn';
          retryBtn.textContent = 'Retry Step';
          retryBtn.onclick = () => retryStep(stepNum);
          details.appendChild(retryBtn);
        }
      }
    }

    function simulateProgress() {
      reset();
      currentStep = 0;

      progressInterval = setInterval(() => {
        currentStep++;

        if (currentStep <= 8) {
          // Mark previous step as completed
          if (currentStep > 1) {
            const prevResult = stepResults[currentStep - 1];
            updateStep(currentStep - 1, 'completed', prevResult.completed);
          }

          // Mark current step as in-progress
          const currentResult = stepResults[currentStep];
          updateStep(currentStep, 'in-progress', currentResult.inProgress);

          // Update subtitle
          document.getElementById('subtitle').textContent = `Step ${currentStep} of 8 in progress...`;
        } else {
          // All steps complete
          clearInterval(progressInterval);
          updateStep(8, 'completed', stepResults[8].completed);
          document.getElementById('subtitle').textContent = 'All steps completed!';

          // Show completion message
          setTimeout(() => {
            document.getElementById('completionMessage').style.display = 'block';
          }, 500);
        }
      }, 1500); // 1.5 seconds per step
    }

    function simulateError() {
      reset();
      // Complete steps 1-2
      updateStep(1, 'completed', stepResults[1].completed);
      updateStep(2, 'completed', stepResults[2].completed);

      // Fail step 3
      setTimeout(() => {
        updateStep(3, 'in-progress', stepResults[3].inProgress);
      }, 500);

      setTimeout(() => {
        updateStep(3, 'failed', 'Failed to access repository. The repository may be private or the GitHub connection expired.<br><br>You can retry this step or check your GitHub integration in Settings.');
        document.getElementById('subtitle').textContent = 'Step 3 failed - Retry to continue';
      }, 2000);
    }

    function retryStep(stepNum) {
      updateStep(stepNum, 'in-progress', stepResults[stepNum].inProgress);

      setTimeout(() => {
        updateStep(stepNum, 'completed', stepResults[stepNum].completed);
        document.getElementById('subtitle').textContent = `Step ${stepNum} completed - Continuing...`;

        // Continue from next step
        if (stepNum < 8) {
          continueFrom(stepNum + 1);
        }
      }, 1500);
    }

    function continueFrom(stepNum) {
      currentStep = stepNum;
      const interval = setInterval(() => {
        if (currentStep <= 8) {
          updateStep(currentStep, 'in-progress', stepResults[currentStep].inProgress);
          document.getElementById('subtitle').textContent = `Step ${currentStep} of 8 in progress...`;

          setTimeout(() => {
            updateStep(currentStep, 'completed', stepResults[currentStep].completed);
            currentStep++;

            if (currentStep > 8) {
              clearInterval(interval);
              document.getElementById('subtitle').textContent = 'All steps completed!';
              setTimeout(() => {
                document.getElementById('completionMessage').style.display = 'block';
              }, 500);
            }
          }, 1500);
        }
      }, 1600);
    }

    function reset() {
      clearInterval(progressInterval);
      currentStep = 0;

      // Reset all steps to pending
      for (let i = 1; i <= 8; i++) {
        const step = document.getElementById(`step-${i}`);
        const icon = step.querySelector('.step-icon');
        const title = step.querySelector('.step-title');
        const details = document.getElementById(`details-${i}`);

        icon.className = 'step-icon pending';
        icon.textContent = i;
        title.className = 'step-title tertiary';
        details.classList.remove('expanded');
        details.innerHTML = `<p>${stepResults[i].inProgress.replace('...', '.')}</p>`;

        // Remove retry buttons
        const retryBtn = details.querySelector('.retry-btn');
        if (retryBtn) retryBtn.remove();
      }

      document.getElementById('subtitle').textContent = 'Click "Simulate Progress" to start generation...';
      document.getElementById('completionMessage').style.display = 'none';
    }

    // Initialize
    reset();
  </script>
</body>
</html>
